<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<!--<meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
	<title>Load the trucks</title>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="/server/views/CSS/Normalize.css" />
	<link rel="stylesheet" type="text/css" href="/server/views/CSS/background_game.css">
	<link rel="stylesheet" type="text/css" href="/server/views/CSS/khung_game.css">
	<link rel="stylesheet" type="text/css" href="/server/views/CSS/loadthetrucks.css">
	<link rel="stylesheet" type="text/css" href="/server/views/CSS/btn_start.css">
	<!-- <link rel="shortcut icon" href="#" /> -->
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
</head>
<body>
	<div class="uchiru">
	<div class="uchiru-bg-cell"></div>
	<div class="uchiru-bg-color"></div>
	<div class="uchiru-bg-stuff"></div>
	<img class="uchiru-bg-color" src="/server/Image/Background/grad-f07e854ce64f9aee2db7bd67146ff0e4800feeed40c8f7116fcb3b6a048deb64.jpg" />
	<div class="uchiru-box">
		<div class="uchiru-head">
			<a class="back-link" href="/server/views/additionAndSuntractionUpTo10.html">
				<div class="arrow-left"></div>
				<span>Back</span>
			</a>
			<div class="uchiru-head__right-group"  onclick="selectLanguage()">
				<a class="uchiru-locale-dropdown__toggle" href="#">
					<span class="uchiru-locale-dropdown__toggle__text">English</span>
					<span class="uchiru-locale-dropdown__toggle__caret"></span>
				</a>
				<ul class="uchiru-locale-dropdown__menu uchiru-locale-dropdown__menu_pull-right" style='display: none'>
					<li class="uchiru-locale-dropdown__menu_item"> 
						<a href="#" class="uchiru-locale-dropdown__menu__item__link">English</a>
					</li>
					<li class="uchiru-locale-dropdown__menu_item">
						<a href="#" class="uchiru-locale-dropdown__menu__item__link">Việt Nam</a>
					</li>
				</ul>
			</div>
			<div class="beads-wrapper">
				<div class="progress">
					<div class="inner_progress">
						<i class="az_ball_0" id="bead0" style="left: 4px;"></i>
						<i class="az_ball_1" id="bead1" style="left: 28px;"></i>
						<i class="az_ball_2" id="bead2" style="left: 52px;"></i>
						<i class="az_ball_3" id="bead3" style="left: 76px;"></i>	
						<i class="az_ball_4" id="bead4" style="left: 100px;"></i>
					</div>
				</div>
			</div>
		</div>
		<div class="card-content">
			<!-- Viết code ở đây-->
			<div id="board" class="uchiru-place card player-1 fixed" style>
				<div class="cont">
					<div class="line">
						<span class="with-sound">
							<span class="speaker" onclick="play()">
								<audio src="" style="display: hidden"></audio>
							</span>
					    	Load the trucks to the top
						</span>
					</div>
					<div class="scene under_start" >
						<div class="truck" style="">
							<div class="smoke_gen"></div>
							<div class="brick_holder">
								<!--
								<div class="loaded_brick" style="height: 141.2px;">
									<div class="cap"></div>
									<span>6</span>
								</div>
								<div class="loaded_brick" style="height: 165.4px;">
									<div class="cap"></div>
									<span>7</span>
								</div>
								<div class="loaded_brick" style="height: 189.6px;">
									<div class="cap"></div>
									<span>8</span>
								</div>
								<div class="loaded_brick" style="height: 213.8px;">
									<div class="cap"></div>
									<span>9</span>
								</div>
								<div class="loaded_brick" style="height: 238px;">
									<div class="cap"></div>
									<span>10</span>
								</div>
							-->
							</div>
							<div class="wheel wheel_0"></div>
							<div class="wheel wheel_1"></div>
							<div class="wheel wheel_2"></div>
						</div>
						<div class="placeholder element0" style="left: 429px; height: 238px; top: 19px;">
							<div class="highlight element0" style="height: 92.8px;" ><i class="element0"></i></div></div>
								
							
						<div class="placeholder element1" style=" left: 494px; height: 238px; top: 19px;">
							<div class="highlight element1" style="height: 68.6px;"><i class="element1"></i></div></div>
							
							
						
						<div class="placeholder element2" style="left: 559px; height: 238px; top: 19px;">
							<div class="highlight element2" style="height: 44.4px;"><i class="element2"></i></div></div>
								
							
						
						<div class="placeholder element3" style="left: 624px; height: 238px; top: 19px;">
							<div class="highlight element3" style="height: 20.2px;"><i class="element3"></i></div></div>
								
							
						
					</div>
					<!--finished -->
					<div class="button_place under_start" >
						<div class="button gradient disabled">
							<span>Ready to go!</span>
						</div>
					</div>
					<!-- finished, openhand -->
					<!--
					<div class="to_load_brick under_start" style="height: 44px; left: 147px; top: 279.6px; touch-action: none;"><div class="cap"></div><span>2</span></div>
					<div class="to_load_brick small under_start" style="height: 20px; left: 212px; top: 303.8px; touch-action: none;"><div class="cap"></div><span>1</span></div>
					<div class="to_load_brick under_start" style="height: 92px; left: 277px; top: 231.2px; touch-action: none;"><div class="cap"></div><span>4</span></div>
					<div class="to_load_brick under_start" style="height: 68px; left: 342px; top: 255.4px; touch-action: none;"><div class="cap"></div><span>3</span></div>
					-->
					<div class="btn_play"  onclick="startLesson()">
						<div class="triangle">
							<span>Start</span>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript" src="server/views/JS/loadthetrucks.js"></script>
<script type="text/javascript" src="server/views/JS/createElement_LoadTheTrucks.js"></script>
<script type="text/javascript" src="server/views/JS/event_loadTheTrucks.js"></script>

<script type="text/javascript">
	var part = 1;

	function handleDrop(event) {
		if(document.getElementsByClassName('scene')[0].classList.toString().indexOf('disabled') > -1) return false;
		if(this.classList.toString().indexOf('done') === -1 && this.classList.toString().indexOf('placeholder') > -1){
			if (event.stopPropagation) {
			    event.stopPropagation(); // stops the browser from redirecting.
			}
			var data = event.dataTransfer.getData('text/html'),
			  	elementSource = document.getElementsByClassName(data)[0];
			var index = this.classList[1].slice(-1),
				indexData = data.split(' ')[2].slice(-1);
			event.target.appendChild(elementSource);

			var brickInTheTruck = Number(document.getElementsByClassName('loaded_brick')[index].style.height.replace('px', '')),
				heightHolder = Number(this.style.height.replace('px', ''))
				brickSelect = Number(elementSource.style.height.replace('px', ''));
			elementSource.style.left = 0;
			elementSource.style.top = heightHolder - brickInTheTruck - brickSelect - 4 +'px';
			this.classList.add('done');
			console.log(this)
			// Người dùng có thể bấm để kiểm tra
			var buttonCheck = document.getElementsByClassName('button_place')[0];
			if(buttonCheck.classList.toString().indexOf('disabled') === -1) {
				buttonCheck.classList.add('finished');
				buttonCheck.addEventListener('click', checkResult);
				document.getElementsByClassName('button')[0].classList.remove('disabled');
			}
		``}
		return false;
	}

	function checkResult(event) {
		if(document.getElementsByClassName('scene')[0].classList.toString().indexOf('disabled') > -1) return false;
		var placeholder = document.getElementsByClassName('placeholder');
		var doneLesson = true;
		for(let i = placeholder.length - 1; i >= 0; i--) {
			if(placeholder[i].classList.toString().indexOf('done') > - 1) {
				var elementNumberAdd = Number(placeholder[i].childNodes[2].childNodes[1].innerText);
				var elementNumberSpace = 10 - numbersLesson.right[part-1][i];
				if(elementNumberAdd === elementNumberSpace){
					console.log('pass');
				}
				else {
					doneLesson = false;
					var elementAdd = placeholder[i].childNodes[2];
					var indexElement = searchNumber(elementAdd.classList.toString());
					elementAdd.parentNode.classList.remove('done');
					document.getElementsByClassName('cont')[0].appendChild(elementAdd);
					elementAdd.style.left =  (147 + 65 * indexElement).toFixed(1) + 'px';
					elementAdd.style.top = (323 - (20 + 24 * (numbersLesson.left[0][indexElement] - 1))) + 'px';
				}
			}
		}
		if(doneLesson) {
			document.getElementsByClassName('scene')[0].classList.add('disabled');
			event.target.classList.add('disabled');
			var scene = document.getElementsByClassName('scene')[0];
			var i = 0;
			
			var id = setInterval(function() {
					++i;
					scene.style.left = (i * 15) + 'px';
					if(i === 50) clearInterval(id);
				} , 100)

		}
	}

	function gameLaucher() {

		var placeHolder = document.getElementsByClassName('placeholder');
		[].forEach.call(placeHolder, function(holder) {
			holder.addEventListener('dragenter', handleDragEnter, false)
			holder.addEventListener('dragover', handleDragOver, false);
			holder.addEventListener('dragleave', handleDragLeave, false);
			holder.addEventListener('drop', handleDrop, false);
		});

		var toLoadBricks = document.getElementsByClassName('to_load_brick');
		[].forEach.call(toLoadBricks, function(brick) {
			brick.addEventListener('dragstart', handleDragStart, false);
			brick.addEventListener('dragend', handleDragEnd, false);
		});
	}

	createBricks(numbersLesson.right[0]);
	createToLoadBricks(numbersLesson.left[0]);
	gameLaucher();

</script>
</body>
</html>
